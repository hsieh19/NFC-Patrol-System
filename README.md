# 数字化巡更指挥系统 (Xungeng)

基于“手机 + 飞书 + NFC标签”打造的低成本、高效率数字化巡更解决方案。采用轻量化架构，支持离线打卡与智能设备区分，全面实现实时监控、异常处置与全量审计。

## 📖 项目简介

本系统致力于解决传统巡检工作中存在的“无法实时监管、离线打卡困难、跨端适配差”等痛点。通过集成飞书 JS-SDK 与服务端全栈框架，实现了一套多端（手机端/电脑端）动态适配、离线可用保障、一键异常响应的新一代智能巡更系统。

### 核心特性

- **一站式多端适配**：统一登录认证，采用动态 User-Agent 智能分流。电脑端登录后自动进入“后台管理页面” ( `/admin` )，手机端登录后自动进入“NFC 巡检打卡页面” ( `/mobile` )。
- **离线与弱网支持**：在有网环境下实时上传巡检数据；针对地下室等网络屏蔽区域，深度集成 `Dexie.js` 提供本地暂存，连网后后台自动进行异步数据上传。
- **NFC极速感应**：手机原生 API 或模拟功能，靠近打卡点即时响应，带有本地音效与强烈震动交互体验。
- **(规划中) 飞书生态接入**：未来可接入飞书 JS-SDK，支持扫描飞书原生二维码、实现免密单点登录及消息卡片推演功能。

---

## 🛠 技术栈

本项目是基于现代前端工程化最佳实践构建的全栈（Full-Stack）系统：

- **核心框架**: [Next.js (App Router)](https://nextjs.org/) - 采用最新的 React 服务端渲染与路由管理能力。
- **UI & 样式**: [Tailwind CSS](https://tailwindcss.com/) + [Shadcn/UI](https://ui.shadcn.com/) - 打造贴合暗黑/极简模式的高颜值现代化界面。
- **图标包**: [Lucide-react](https://lucide.dev/) - 统一、轻量、高颜值的 SVG 矢量图标库。
- **本地存储**: [Dexie.js](https://dexie.org/) - 强大的 IndexedDB 封装层，用于离线打卡数据的本地持久化及同步。
- **权限与拦截**: Next.js Middleware - 实现统一的路由拦截验证与终端鉴权拦截。

---

## 📂 核心功能模块与现状

### 1. 通用模块
- [x] **统一登录与鉴权**：深色风格高颜值登录卡片，支持常规账户登入及飞书入口拓展。
- [x] **智能分流中间件**：`middleware.ts` 拦截未登录访问，`page.tsx` 根据浏览器设备信息(UA)自动跳转至对应的控制权主页。

### 2. 手机端 (Mobile - `/mobile`)
- [x] **界面重构**：离线及NFC专属的打卡操作主页面。
- [x] **NFC读写模块**：NFC感应打卡本地逻辑的对接（已实现模拟感应、音频提醒与强震动交互反馈）。
- [x] **异常报修提报**：利用本机设备进行异常登记的页面（已支持描述、多图预览与模拟提交至本地缓存）。
- [x] **离线打卡同步**：对接 Dexie.js，监听网络状态自动重新发送排队数据（后台静默轮询重试上传）。

### 3. 电脑网页端 (Admin - `/admin`)
- [x] **监控主控制台**：涵盖“实时监控中”大屏级列表台账、“近日动态录入”表格渲染（已对接真实数据并实现轮询）。
- [x] **选项卡组件**：监控/巡检点配置/排班计划/人员管理的快速标签切换。
- [x] **点位与人员功能**：管理员针对 NFC 标签、人员进行的管理端配置页面（CRUD 逻辑已打通）。
- [ ] **权限规则配置**：排班计划的配置与自动推流。
- [ ] **巡检结果审计**：打卡记录全量数据流拉取及导出。

---

## 🚀 部署与开发

### 环境要求
- Node.js >= 18.0.0

### 安装依赖
所有依赖均必须通过 npm 安装，严禁使用外部 CDN。

```bash
npm install
```

### 启动本地开发服务
```bash
npm run dev
```
打开本地浏览器访问 `http://localhost:3000`。
未登录状态下会自动重定向至 `/login`；在浏览器“模拟手机测试”时进入打卡页，电脑系统登录则进入管理员控制台。

### 打包发布
```bash
npm run build
npm run start
```

---

## 👨‍💻 角色说明

1. **管理员（Admin）**：
   - 包含操作员所有权限。
   - 在后台中管理所有人员及硬件架构（如配置NFC标签绑定地点、维护巡检路线、制定时间排班表）。
   - 查看与审计巡检状态及所有历史打卡报表。
2. **操作员（Operator）**：
   - 到达现场开启系统后进行巡更打卡工作。
   - 遭遇环境异常即时使用内部模块拍照并提报。


*注：本项目坚持 KISS（Keep It Simple, Stupid）原则，不使用 "// TODO" 等代理解析，功能务必编写完整逻辑，界面采用最高级深色质感与玻璃拟态效果以保障优秀用户体验。*
